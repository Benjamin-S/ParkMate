@model DistanceSearchDTO

@{
    ViewData["Title"] = "Search";
}

<br/>
<h1> Search </h1>
<br/>

<form method="post" enctype="multipart/form-data" id="form">
    <div class="input-group">
        <input class="form-control" type="text" autocomplete="off" placeholder="Search..." id="searchBar">
        <div class="input-group-append">
            <select asp-for="DistanceInMeters" id="stateInput" class="custom-select">
                <option value="100">+100m</option>
                <option value="250">+250m</option>
                <option value="500">+500m</option>
                <option value="750">+750m</option>
                <option value="1000">+1km</option>
                <option value="2000">+2km</option>
            </select>
        </div>           
    </div>
    
    <button type="submit" class="btn btn-primary mt-1">Search</button>
    
    <ul class="list-group" id="results"></ul>
    <div class="form-group">
        <input asp-for="Latitude" id="latitudeInput" type="hidden" class="form-control"/>
        <span asp-validation-for="Latitude" class="text-danger"></span>
    </div>
     
    <div class="form-group">
        <input asp-for="Longitude" id="longitudeInput" type="hidden" class="form-control"/>
        <span asp-validation-for="Longitude" class="text-danger"></span>
    </div>
</form>


@section Scripts {
    <script>
        $("#searchBar").on("input",
            function() {
                var inputText = $(this).val();

                if (inputText.match("[a-zA-Z]")) { 
                    $.get('@Url.Action("SearchAutoComplete")',
                        { searchInput: inputText },
                        function(data) {
                            $("#results").empty();

                            for (i = 0; i < data.length; i++) {                           
                                $("#results").append('<a href="#" class="list-group-item list-group-item-action" ' +
                                    'id="' + data[i].id +'">' +
                                    data[i].street + ", " +
                                    data[i].city + ", " +
                                    data[i].state +
                                    "</li>");
                                $("#results a:last-child").data(data[i]);                 
                            }

                            if ($("#results").is(":hidden")) {
                                $("#results").show();
                            }
                        });
                }
            });

        $(document).on("click", "#results > a", function() {
            
            $("#latitudeInput").val($(this).data().latitude);
            $("#longitudeInput").val($(this).data().longitude);   
            
            $("#searchBar").val($(this).text());
            $("#results").empty();
        });
    </script>
}